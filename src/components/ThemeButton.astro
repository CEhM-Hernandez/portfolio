---
import ThemeIcon from '@icons/ThemeIcon.astro';
---

<button
  id="theme-button"
  class="flex rounded-full bg-background text-center items-center justify-center transition-transform duration-500 ease-in-out transform hover:rotate-180 hover:scale-110 h-12 w-12 md:h-10 md:w-10 dark:hover:text-yellow-500 hover:text-accent"
>
  <span class="sr-only"></span>
  <ThemeIcon />
</button>

<script is:inline>
  window.getThemePreferences = () => {
    const localItem =
      typeof localStorage !== 'undefined' && localStorage.getItem('theme');

    if (localItem) return localItem;
    return window.matchMedia('(prefers-color-scheme: dark)').matches
      ? 'dark'
      : 'light';
  };

  const isDark = window.getThemePreferences() === 'dark';
  document.documentElement.classList.toggle('dark', isDark);

  const handleTogglePreference = () => {
    const element = document.documentElement;
    element.classList.toggle('dark');

    const isDark = element.classList.contains('dark');
    updateMsg(isDark);
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
  };

  document
    .getElementById('theme-button')
    .addEventListener('click', handleTogglePreference);

  function updateMsg(isDark) {
    const msg = isDark ? 'Cambiar a tema claro' : 'Cambiar a tema oscuro';
    document.querySelector('span.sr-only').textContent = msg;
  }
</script>
